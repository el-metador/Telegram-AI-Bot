# Telegram AI Bot (Groq + OpenRouter)

Telegram-бот для общения с разными LLM через OpenRouter и Groq, с удобным выбором модели, power-tier и режимом генерации кода в файлы через `/build`.

## Возможности

- Поддержка двух провайдеров: `OpenRouter`, `Groq`
- Выбор модели:
  - через `Model Browser`
  - через список `Все ИИ`
  - через `Smart AI Picker` (по цели: coding/reasoning/speed/...)
- Выбор мощности: `Low`, `Medium`, `High`, `eHigh`
- Пользовательский системный промпт (`set/view/reset`)
- Хранение контекста в памяти (без БД)
- Режим генерации кода `/build`:
  - генерирует файлы в `generated/<telegram_user_id>/...`
  - отправляет созданные файлы в чат документами
  - отправляет инструкции запуска
- Большие текстовые ответы автоматически отправляются `.txt` файлом + превью

## Главное поведение

### Обычный чат

- Любое обычное сообщение отправляется в выбранную модель.
- Если сообщение похоже на запрос генерации кода, бот подсказывает использовать `/build`.

### Генерация кода (`/build`)

- Вариант 1: сразу с задачей

```bash
/build Сделай лендинг пиццерии в index.html
```

- Вариант 2: пошагово

```bash
/build
```

После этого бот попросит прислать задачу следующим сообщением.

Во время генерации бот показывает служебное сообщение:

`Генерация вашего кода, ожидайте...*`

После завершения оно удаляется, и бот отправляет итог.

## Команды

- `/start`, `/menu` - главное меню
- `/model` - браузер моделей по провайдерам
- `/models` - список всех добавленных ИИ
- `/ai` - smart picker (цель -> провайдер -> мощность -> топ моделей)
- `/power` - выбор мощности
- `/prompt` - управление системным промптом
- `/build <задача>` - генерация проекта/кода в файлы
- `/settings` - текущие настройки
- `/clear` - очистка истории диалога

## Быстрый старт

1. Установить зависимости:

```bash
npm install
```

2. Создать `.env`:

```bash
cp .env.example .env
```

3. Заполнить переменные:

```env
TELEGRAM_BOT_TOKEN=...
OPENROUTER_API_KEY=...
GROQ_API_KEY=...
```

4. Запуск в dev:

```bash
npm run dev
```

5. Сборка:

```bash
npm run build
```

## Структура проекта

```text
src/
  application/
    services/
      artifact-mode.ts
  infrastructure/
    providers/
    files/
      artifact-writer.ts
  transport/
    telegram/
      bot.ts
config/
  models.catalog.json
docs/
  telegram-bot-architecture.md
generated/
  <telegram_user_id>/
```

## Как работает вывод файлов

- Созданные файлы сохраняются локально в папку пользователя:
  - `generated/<telegram_user_id>/...`
- Каждый сгенерированный файл бот отправляет документом в Telegram.
- Дублирование полного кода в текстовых сообщениях отключено (чтобы не засорять чат).

## Важные детали по моделям

Некоторые модели/провайдеры не поддерживают `system/developer` инструкции в исходном виде. В боте есть fallback:

- если провайдер возвращает ошибку вида
  - `Developer instruction is not enabled ...`
- бот автоматически повторяет запрос в совместимом формате.

## Ограничения текущей версии

- Без БД: настройки и история очищаются при перезапуске процесса
- Каталог моделей статический: `config/models.catalog.json`
- Генерация бинарных артефактов (например реальных `.jpg`) не поддерживается в `/build`:
  - бот и prompt ориентированы на текстовые файлы
  - для изображений лучше использовать `.svg` или внешние URL

## Рекомендации

- Для сложной генерации кода лучше выбирать модели более высокого уровня (`High/eHigh`).
- Если конкретная модель часто отдает нестабильный JSON в `/build`, переключитесь на другую модель через `Все ИИ`.

